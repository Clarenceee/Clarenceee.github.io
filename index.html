<html>
<head>
  <meta http-equiv="refresh" content="180">
  <title>Extract Sensor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
  <script type="text/javascript">
	var x = document.getElementById("demo");
	var y = document.getElementById("demo2");
	var acl = new Accelerometer({frequency:60});
	  
	var clientId = "client_id";
	var server ="outstanding-engineer.cloudmqtt.com";
	var mqtt_port = 443;
	var mqtt_destname = "SEND LA DIU";
	var client = new Paho.MQTT.Client(server, mqtt_port, clientId);
	var longtitude  = 0;
	  
	function init () {
    		client.connect({
		useSSL: true,
        	userName: "odzguzja",
        	password: "XIC7binxmQ8e",
        	onSuccess: createDevice
    		});
	}
	
	function createDevice () {
		//client.subscribe(mqtt_destname);
		//message = new Paho.MQTT.Message(mqtt_msg);
  		//message.destinationName = mqtt_destname;
  		//client.send(message);
		
		if (navigator.geolocation) {
    			navigator.geolocation.getCurrentPosition(showPosition);
			//navigator.geolocation.watchPosition(showPosition);
  		} else {
   			demo.innerHTML = "Geolocation is not supported by this browser.";
  		}
		

		function showPosition(position) {
   		
		console.log("SEND THIS");
		var mqtt_msg = "69696969";
		client.subscribe(mqtt_destname);
		message = new Paho.MQTT.Message(mqtt_msg);
  		message.destinationName = mqtt_destname;
  		client.send(message);
			
 		demo.innerHTML = "Latitude: " + position.coords.latitude +
  		"<br>Longitude: " + position.coords.longitude +
		"<br>Heading: " + position.coords.heading;
		//var gps_msg =  "position.coords.longtitude" ;
		
		}
	
	}

	  
	function getAcceleration(){
	

		console.log(acl);
		acl.addEventListener('reading', () => {
		demo2.innerHTML ="Acceleration along the X-axis " + acl.x + 
		"<br>Acceleration along the Y-axis " + acl.y +
		"<br>Acceleration along the Z-axis " + acl.z;
		});
		acl.start();
		
	}
	navigator.connection.addEventListener('change', logNetworkInfo);

	//window.addEventListener("deviceorientation", handleOrientation, true);
	function handleOrientation(event) {
		demo3.innerHTML = "<br> alpha : " + event.alpha + 
		"<br> beta : " + event.beta + "<br> gamma : " + event.gamma ;
	}
	
	var gyroscope = new Gyroscope({frequency: 60});
	
	function getGyroscope() {
		gyroscope.addEventListener('reading', ( ) => {
  		demo4.innerHTML = "Gyroscope X-axis " + gyroscope.x +
  		"<br>Gyroscope Y-axis " + gyroscope.y  + "<br>Gyroscope Z-axis " + gyroscope.z;
		});
		gyroscope.start();
	}
	
  </script>
</head>
<body>
	<h1>TRC3000</h1>
	<div id="demo">Loading Location...</div> 
	<div id="demo2">Loading Acceleration...</div> 
	<div id="demo3">Loading Orientation...</div> 
	<div id="demo4">Loading Gyroscope...</div> 

	
	<script>
		//getLocation();
		//handleOrientation();
		init();
	</script>
</body>
</html>
